<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domotique</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="/css/status.css" rel="stylesheet" type="text/css">
</head>

{{define "Device"}}
<div class="device-card device-row" data-room="{{.Room}}">
    <div class="device-header">
        <span class="device-name">{{.Device.Name}}</span>
        <span class="device-type">{{.Device.Type}}</span>
    </div>
    {{if eq .Device.NewFirmware true}}
    <div class="device-alert">
        <span class="material-icons">warning</span>
        New firmware available
        <button class="btn btn-small" onclick="runAction({{.Device.ParentId}},'/command','update_fw')">Update</button>
    </div>
    {{end}}
    <div class="device-content">
        {{if eq .Device.DeviceType ""}}
        {{template "Switch" dict "Device" .Device "Room" .Room}}
        {{ else if eq .Device.DeviceType "ROLLER"}}
        {{template "Roller" dict "Device" .Device "Room" .Room}}
        {{ else if eq .Device.DeviceType "SHTRV"}}
        {{template "Radiator" dict "Device" .Device "Room" .Room}}
        {{ else if eq .Device.DeviceType "SHELLY4PM"}}
        {{template "SHELLY4PM" dict "Device" .Device "Room" .Room}}
        {{ else if eq .Device.DeviceType "SHELLYHT"}}
        {{template "SHELLYHT" dict "Device" .Device "Room" .Room}}
        {{ else if eq .Device.DeviceType "ShellyI3"}}
        {{template "ShellyI3" dict "Device" .Device "Room" .Room}}
        {{ else if eq .Device.DeviceType "ShellyUni"}}
        {{template "ShellyUni" dict "Device" .Device "Room" .Room}}
        {{ else if eq .Device.DeviceType "shellydw2"}}
        {{template "ShellyDW2" dict "Device" .Device "Room" .Room}}
        {{ end}}
    </div>
    <div class="device-footer">
        <small>
            <a href="http://{{.Device.DeviceUrl}}" target="_blank">{{.Device.DeviceId}}</a>
            {{if .Device.NameRegistered}}<i>{{.Device.NameRegistered}}</i>{{end}}
        </small>
    </div>
</div>
{{end}}

<body>
<input type="hidden" name="ipPort" id="ipPort" value="{{.IpPort}}"/>

<!-- Dark mode toggle -->
<button class="theme-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">
    <span class="material-icons">brightness_6</span>
</button>

<!-- Snackbar -->
<div id="snackbar" class="snackbar"></div>

<!-- Summary Panel -->
<div class="summary-panel">
    <div class="summary-grid">
        <div class="summary-item">
            <div class="summary-value" id="totalpower">{{round2 .Totals.Watts}} W</div>
            <div>Total Power</div>
        </div>
        <div class="summary-item">
            {{if .IsHeating}}
            <div class="summary-value red" style="border-radius: 8px; padding: 8px;">
                <span class="material-icons">local_fire_department</span>
            </div>
            {{ else }}
            <div class="summary-value green" style="border-radius: 8px; padding: 8px;">
                <span class="material-icons">check_circle_outline</span>
            </div>
            {{end}}
            <div>Heater Status</div>
        </div>
        <div class="summary-item">
            {{ if .IsCorrectTemperature}}
            <div class="summary-value green" style="border-radius: 8px; padding: 8px;">{{.Temperature_Requested}} ¬∞C</div>
            {{ else }}
            <div class="summary-value red" style="border-radius: 8px; padding: 8px;">{{.Temperature_Requested}} ¬∞C</div>
            {{ end }}
            <div>Requested</div>
        </div>
        <div class="summary-item">
            {{ if .IsCorrectTemperature}}
            <div class="summary-value green" style="border-radius: 8px; padding: 8px;">{{.Temperature_Actual}} ¬∞C</div>
            {{ else }}
            <div class="summary-value red" style="border-radius: 8px; padding: 8px;">{{.Temperature_Actual}} ¬∞C</div>
            {{ end }}
            <div>Actual</div>
        </div>
    </div>
    {{if .IsTemporary}}
    <div class="mt-2 text-center">
        <strong>Temporary:</strong> {{.TemporaryLevel}} until {{.Until}}
    </div>
    {{end}}
</div>

<!-- Dynamic Room Tabs -->
<div class="tabs-container">
    {{range .Rooms}}
    <button class="tabButton" data-room="{{.Name}}" onclick="changeActiveTabTo('{{.Name}}')">
        <b>{{displayName .Name}}</b>
        <span class="power-display" data-room-power="{{.Name}}"></span>
    </button>
    {{end}}
    <button class="tabButton" data-room="logs" onclick="changeActiveTabTo('logs')">
        <b>Logs</b>
    </button>
</div>

<!-- Devices Grid -->
<div class="devices-grid">
    {{range .DevicesNew}}
    {{template "Device" dict "Device" . "Room" .Room}}
    {{end}}
</div>

<!-- Logs Panel -->
<div class="device-card device-row" data-room="logs">
    <div class="device-header">
        <span class="device-name">System Logs</span>
    </div>
    <div class="device-content">
        <div class="info-row">
            <span class="info-label">Last Update:</span>
            <span class="info-value">{{.UpdateTime}}</span>
        </div>
        <div class="info-row mt-1">
            <button class="btn" onclick="runReconnect();">
                <span class="material-icons" style="vertical-align: middle;">refresh</span>
                Reconnect
            </button>
        </div>
    </div>
</div>

<script src="/js/set.js"></script>
</body>
</html>
