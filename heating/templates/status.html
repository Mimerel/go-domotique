<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domotique</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <link href="/css/status.css" rel="stylesheet" type="text/css">
</head>

{{define "Device"}}
<tr class="device-row" data-room="{{.Room}}">
    <td colspan="5" style="background-color: var(--color-header-bg); height: 20px"></td>
</tr>
<tr class="device-row" data-room="{{.Room}}" style="height: 40px">
    {{if eq .Device.NewFirmware true}}
    <td colspan="3" class="leftText" style="color: var(--color-danger)">
        {{.Device.Name}} ({{.Device.DomotiqueId}} - <a href="http://{{.Device.DeviceUrl}}" target="_blank">{{.Device.DeviceId}}</a>)
        <button class="btn btn-small"
                onclick="runAction({{.Device.ParentId}},'/command','update_fw')">Update
        </button>
    </td>
    <td class="leftText">{{.Device.Type}}</td>
    {{else}}
    <td colspan="3" class="leftText"><span class="device-name">{{.Device.Name}}</span></td>
    <td class="leftText">{{.Device.Type}}</td>
    <td class="text-center text-small">
        ({{.Device.DomotiqueId}} - <a href="http://{{.Device.DeviceUrl}}" target="_blank">{{.Device.DeviceId}}</a>)<br>
        <i>{{.Device.NameRegistered}}</i>
    </td>
    {{end}}
</tr>

{{if eq .Device.DeviceType ""}}
{{template "Switch" dict "Device" .Device "Room" .Room}}
{{ else if eq .Device.DeviceType "ROLLER"}}
{{template "Roller" dict "Device" .Device "Room" .Room}}
{{ else if eq .Device.DeviceType "SHTRV"}}
{{template "Radiator" dict "Device" .Device "Room" .Room}}
{{ else if eq .Device.DeviceType "SHELLY4PM"}}
{{template "SHELLY4PM" dict "Device" .Device "Room" .Room}}
{{ else if eq .Device.DeviceType "SHELLYHT"}}
{{template "SHELLYHT" dict "Device" .Device "Room" .Room}}
{{ else if eq .Device.DeviceType "ShellyI3"}}
{{template "ShellyI3" dict "Device" .Device "Room" .Room}}
{{ else if eq .Device.DeviceType "ShellyUni"}}
{{template "ShellyUni" dict "Device" .Device "Room" .Room}}
{{ else if eq .Device.DeviceType "shellydw2"}}
{{template "ShellyDW2" dict "Device" .Device "Room" .Room}}
{{ end}}
<tr class="device-row" data-room="{{.Room}}">
    <td colspan="5" style="height: 10px"></td>
</tr>
{{end}}

<body>
<input type="hidden" name="ipPort" id="ipPort" value="{{.IpPort}}"/>

<!-- Dark mode toggle -->
<button class="theme-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">
    <span class="material-icons">brightness_6</span>
</button>

<!-- Snackbar -->
<div id="snackbar" class="snackbar"></div>

<!-- Summary Panel -->
<div class="summary-panel">
    <div class="summary-grid">
        <div class="summary-item">
            <div class="summary-value" id="totalpower">{{round2 .Totals.Watts}} W</div>
            <div>Total Power</div>
        </div>
        <div class="summary-item">
            {{if .IsHeating}}
            <div class="summary-value red" style="border-radius: 8px; padding: 8px;">
                <span class="material-icons">local_fire_department</span>
            </div>
            {{ else }}
            <div class="summary-value green" style="border-radius: 8px; padding: 8px;">
                <span class="material-icons">check_circle_outline</span>
            </div>
            {{end}}
            <div>Heater Status</div>
        </div>
        <div class="summary-item">
            {{ if .IsCorrectTemperature}}
            <div class="summary-value green" style="border-radius: 8px; padding: 8px;">{{.Temperature_Requested}} ¬∞C</div>
            {{ else }}
            <div class="summary-value red" style="border-radius: 8px; padding: 8px;">{{.Temperature_Requested}} ¬∞C</div>
            {{ end }}
            <div>Requested</div>
        </div>
        <div class="summary-item">
            {{ if .IsCorrectTemperature}}
            <div class="summary-value green" style="border-radius: 8px; padding: 8px;">{{.Temperature_Actual}} ¬∞C</div>
            {{ else }}
            <div class="summary-value red" style="border-radius: 8px; padding: 8px;">{{.Temperature_Actual}} ¬∞C</div>
            {{ end }}
            <div>Actual</div>
        </div>
    </div>
    {{if .IsTemporary}}
    <div class="mt-2 text-center">
        <strong>Temporary:</strong> {{.TemporaryLevel}} until {{.Until}}
    </div>
    {{end}}
</div>

<!-- Dynamic Room Tabs -->
<div class="tabs-container">
    {{range .Rooms}}
    <button class="tabButton" data-room="{{.Name}}" onclick="changeActiveTabTo('{{.Name}}')">
        <b>{{displayName .Name}}</b>
        <span class="power-display" data-room-power="{{.Name}}"></span>
    </button>
    {{end}}
    <button class="tabButton" data-room="logs" onclick="changeActiveTabTo('logs')">
        <b>Logs</b>
    </button>
</div>

<!-- Devices Container -->
<div class="devices-container">
    <table>
        {{range .DevicesNew}}
        {{template "Device" dict "Device" . "Room" .Room}}
        {{end}}
    </table>
</div>

<!-- Logs Panel -->
<div class="devices-container mt-2 device-row" data-room="logs">
    <table>
        <tr>
            <td><strong>Last Update:</strong></td>
            <td>{{.UpdateTime}}</td>
        </tr>
        <tr>
            <td><strong>Reconnect:</strong></td>
            <td>
                <button class="btn" onclick="runReconnect();">
                    <span class="material-icons" style="vertical-align: middle;">refresh</span>
                    Reconnect
                </button>
            </td>
        </tr>
    </table>
</div>

<script src="/js/set.js"></script>
</body>
</html>
